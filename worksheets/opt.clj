;; gorilla-repl.fileformat = 1

;; **
;;; # Optimization Benchmarks
;; **

;; @@
(ns worksheets.opt
  (:require [gorilla-plot.core :as plot]
            [clojure.core.matrix :as mat]
            [bopp.core :refer :all])
  (:use [anglican runtime emit]))
;; @@
;; =>
;;; {"type":"html","content":"<span class='clj-nil'>nil</span>","value":"nil"}
;; <=

;; **
;;; In this worksheet we consider simply using BOPP as an optimizer on some classic Bayesian optimization benchmark problems.  Results for some popular packages on the same problems are presented in the paper.
;; **

;; @@
(defdist factor
  []
  (sample* [this] 0)
  (observe* [this value] value))
;; @@
;; =>
;;; {"type":"html","content":"<span class='clj-unkown'>#multifn[print-method 0x26504432]</span>","value":"#multifn[print-method 0x26504432]"}
;; <=

;; **
;;; ## Branin
;; **

;; **
;;; @@f(x) = \left(x\_2-\frac{5.1}{4\pi^2}x\_1^2+\frac{5}{\pi}x\_1-6\right)^2+10(1-\frac{1}{8\pi}\cos(x\_1))+10@@
;;; 
;;; Bounds @@-5 \le x\_1 \le 10@@ and @@0 \le x\_2 \le 15@@.
;;; 
;;; There are three global minimum, @@f(x^\*) = 0.397887@@ at @@x^\* = (-\pi,12,1275), (\pi,2.275) ~\rm{and}~ (9.42478,2.475)@@.
;; **

;; @@
(with-primitive-procedures [factor]
  (defopt branin-opt [] [x1 x2]
   (let [x1 (sample (uniform-continuous -5 10))
         x2 (sample (uniform-continuous 0 15))
         t1 (- (+ (- x2 (* (pow x1 2) (/ 5.1 (* 4 (pow Math/PI 2)))))
                  (* x1 (/ 5 Math/PI)))
               6)
         t2 (* 10
               (- 1 (/ 1 (* 8 Math/PI)))
               (cos x1))
         branin (- 0 (+ (pow t1 2) t2 10))
         prior-correction (+ (log 15) (log 15))]
     (observe (factor) (+ branin prior-correction)))))
;; @@
;; =>
;;; {"type":"html","content":"<span class='clj-var'>#&#x27;worksheets.opt/branin-opt</span>","value":"#'worksheets.opt/branin-opt"}
;; <=

;; @@
(def branin-samples (->> (doopt :importance branin-opt [] 1 :bo-verbose true)
                		 (take 50) ;; Number of optimization iterations to do
                		 doall
                		 (mapv #(take 2 %))))
;; @@
;; ->
;;; :initial-thetas [[1.8193640032945906 0.10588248312951354] [3.1760606102465445 14.560390416206197] [4.196397693164789 1.7520348440331424] [-2.596973746509696 10.109625165229993] [5.284679463477106 0.4290871604706603]]
;;; :initial-log-Zs [-19.376036241552832 -151.9918179684248 -5.286648765706109 -2.5878180336039724 -15.7898241053797]
;;; :BO-Iteration 1
;;; :n-gps-in-acq-function 50
;;; :acq-opt [0.0690472382215737]
;;; :theta-best [-2.596973746509696 10.109625165229993]     :log-Z-theta-best -2.5878180336039724     :mean-theta-best -2.589248549773771     :std-dev-theta-best 0.19033320381900776     :i-best 3
;;; :theta-next [-3.5372435426384774 9.767798818861184]
;;; Calling original query with theta next  
;;; :log-Z-theta-next -13.238035246779834
;;; :log-Z-i-best -2.5878180336039724
;;; :theta-mean-best ([-2.596973746509696 10.109625165229993] -2.589248549773771)
;;; :BO-Iteration 2
;;; :n-gps-in-acq-function 50
;;; :acq-opt [0.059865291434445786]
;;; :theta-best [-2.596973746509696 10.109625165229993]     :log-Z-theta-best -2.5878180336039724     :mean-theta-best -2.5892868964215836     :std-dev-theta-best 0.13600453097515228     :i-best 4
;;; :theta-next [-1.130594767264522 8.850220328327513]
;;; Calling original query with theta next  
;;; :log-Z-theta-next -14.876122630176535
;;; :log-Z-i-best -2.5878180336039724
;;; :theta-mean-best ([-2.596973746509696 10.109625165229993] -2.5892868964215836)
;;; :BO-Iteration 3
;;; :n-gps-in-acq-function 50
;;; :acq-opt [0.04683245653274273]
;;; :theta-best [-2.596973746509696 10.109625165229993]     :log-Z-theta-best -2.5878180336039724     :mean-theta-best -2.589766324342662     :std-dev-theta-best 0.18162214895503415     :i-best 5
;;; :theta-next [1.8799007959533185 3.8820964238324813]
;;; Calling original query with theta next  
;;; :log-Z-theta-next -7.253297423927435
;;; :log-Z-i-best -2.5878180336039724
;;; :theta-mean-best ([-2.596973746509696 10.109625165229993] -2.589766324342662)
;;; :BO-Iteration 4
;;; :n-gps-in-acq-function 50
;;; :acq-opt [0.05342812474845413]
;;; :theta-best [-2.596973746509696 10.109625165229993]     :log-Z-theta-best -2.5878180336039724     :mean-theta-best -2.5951063652133257     :std-dev-theta-best 0.3106880132083197     :i-best 6
;;; :theta-next [0.8178827108789566 2.1620718336570777]
;;; Calling original query with theta next  
;;; :log-Z-theta-next -23.443871390753806
;;; :log-Z-i-best -2.5878180336039724
;;; :theta-mean-best ([-2.596973746509696 10.109625165229993] -2.5951063652133257)
;;; :BO-Iteration 5
;;; :n-gps-in-acq-function 50
;;; :acq-opt [0.05202381419952755]
;;; :theta-best [-2.596973746509696 10.109625165229993]     :log-Z-theta-best -2.5878180336039724     :mean-theta-best -2.588945641994002     :std-dev-theta-best 0.10834218499122884     :i-best 7
;;; :theta-next [3.52121914070068 3.4750193669251335]
;;; Calling original query with theta next  
;;; :log-Z-theta-next -3.2644070422401503
;;; :log-Z-i-best -2.5878180336039724
;;; :theta-mean-best ([-2.596973746509696 10.109625165229993] -2.588945641994002)
;;; :BO-Iteration 6
;;; :n-gps-in-acq-function 50
;;; :acq-opt [0.04917683318584628]
;;; :theta-best [-2.596973746509696 10.109625165229993]     :log-Z-theta-best -2.5878180336039724     :mean-theta-best -2.590239795018448     :std-dev-theta-best 0.16393397207323557     :i-best 8
;;; :theta-next [3.068384471468643 2.5538992034422354]
;;; Calling original query with theta next  
;;; :log-Z-theta-next -0.4724985732130431
;;; :log-Z-i-best -2.5878180336039724
;;; :theta-mean-best ([-2.596973746509696 10.109625165229993] -2.590239795018448)
;;; :BO-Iteration 7
;;; :n-gps-in-acq-function 50
;;; :acq-opt [0.03268310296317489]
;;; :theta-best [3.068384471468643 2.5538992034422354]     :log-Z-theta-best -0.4724985732130431     :mean-theta-best -0.47325746213894604     :std-dev-theta-best 0.13016875142691936     :i-best 0
;;; :theta-next [-2.4814007410999013 4.819806007733819]
;;; Calling original query with theta next  
;;; :log-Z-theta-next -37.51997701174839
;;; :log-Z-i-best -0.4724985732130431
;;; :theta-mean-best ([3.068384471468643 2.5538992034422354] -0.47325746213894604)
;;; :BO-Iteration 8
;;; :n-gps-in-acq-function 50
;;; 
;; <-

;; @@
branin-samples
;; @@
;; =>
;;; {"type":"list-like","open":"<span class='clj-vector'>[</span>","close":"<span class='clj-vector'>]</span>","separator":" ","items":[{"type":"list-like","open":"<span class='clj-lazy-seq'>(</span>","close":"<span class='clj-lazy-seq'>)</span>","separator":" ","items":[{"type":"list-like","open":"<span class='clj-vector'>[</span>","close":"<span class='clj-vector'>]</span>","separator":" ","items":[{"type":"html","content":"<span class='clj-double'>2.3845486350346663</span>","value":"2.3845486350346663"},{"type":"html","content":"<span class='clj-double'>0.6159033330347463</span>","value":"0.6159033330347463"}],"value":"[2.3845486350346663 0.6159033330347463]"},{"type":"html","content":"<span class='clj-double'>-8.419822392806765</span>","value":"-8.419822392806765"}],"value":"([2.3845486350346663 0.6159033330347463] -8.419822392806765)"},{"type":"list-like","open":"<span class='clj-lazy-seq'>(</span>","close":"<span class='clj-lazy-seq'>)</span>","separator":" ","items":[{"type":"list-like","open":"<span class='clj-vector'>[</span>","close":"<span class='clj-vector'>]</span>","separator":" ","items":[{"type":"html","content":"<span class='clj-double'>3.8264082295532678</span>","value":"3.8264082295532678"},{"type":"html","content":"<span class='clj-double'>1.6600246609764178</span>","value":"1.6600246609764178"}],"value":"[3.8264082295532678 1.6600246609764178]"},{"type":"html","content":"<span class='clj-double'>-2.584789801536374</span>","value":"-2.584789801536374"}],"value":"([3.8264082295532678 1.6600246609764178] -2.584789801536374)"},{"type":"list-like","open":"<span class='clj-lazy-seq'>(</span>","close":"<span class='clj-lazy-seq'>)</span>","separator":" ","items":[{"type":"list-like","open":"<span class='clj-vector'>[</span>","close":"<span class='clj-vector'>]</span>","separator":" ","items":[{"type":"html","content":"<span class='clj-double'>3.8264082295532678</span>","value":"3.8264082295532678"},{"type":"html","content":"<span class='clj-double'>1.6600246609764178</span>","value":"1.6600246609764178"}],"value":"[3.8264082295532678 1.6600246609764178]"},{"type":"html","content":"<span class='clj-double'>-2.5858003260117925</span>","value":"-2.5858003260117925"}],"value":"([3.8264082295532678 1.6600246609764178] -2.5858003260117925)"},{"type":"list-like","open":"<span class='clj-lazy-seq'>(</span>","close":"<span class='clj-lazy-seq'>)</span>","separator":" ","items":[{"type":"list-like","open":"<span class='clj-vector'>[</span>","close":"<span class='clj-vector'>]</span>","separator":" ","items":[{"type":"html","content":"<span class='clj-double'>3.8264082295532678</span>","value":"3.8264082295532678"},{"type":"html","content":"<span class='clj-double'>1.6600246609764178</span>","value":"1.6600246609764178"}],"value":"[3.8264082295532678 1.6600246609764178]"},{"type":"html","content":"<span class='clj-double'>-2.584761305260429</span>","value":"-2.584761305260429"}],"value":"([3.8264082295532678 1.6600246609764178] -2.584761305260429)"},{"type":"list-like","open":"<span class='clj-lazy-seq'>(</span>","close":"<span class='clj-lazy-seq'>)</span>","separator":" ","items":[{"type":"list-like","open":"<span class='clj-vector'>[</span>","close":"<span class='clj-vector'>]</span>","separator":" ","items":[{"type":"html","content":"<span class='clj-double'>3.167417697779358</span>","value":"3.167417697779358"},{"type":"html","content":"<span class='clj-double'>2.5491194809779607</span>","value":"2.5491194809779607"}],"value":"[3.167417697779358 2.5491194809779607]"},{"type":"html","content":"<span class='clj-double'>-0.491256816081318</span>","value":"-0.491256816081318"}],"value":"([3.167417697779358 2.5491194809779607] -0.491256816081318)"},{"type":"list-like","open":"<span class='clj-lazy-seq'>(</span>","close":"<span class='clj-lazy-seq'>)</span>","separator":" ","items":[{"type":"list-like","open":"<span class='clj-vector'>[</span>","close":"<span class='clj-vector'>]</span>","separator":" ","items":[{"type":"html","content":"<span class='clj-double'>3.167417697779358</span>","value":"3.167417697779358"},{"type":"html","content":"<span class='clj-double'>2.5491194809779607</span>","value":"2.5491194809779607"}],"value":"[3.167417697779358 2.5491194809779607]"},{"type":"html","content":"<span class='clj-double'>-0.4910055473622208</span>","value":"-0.4910055473622208"}],"value":"([3.167417697779358 2.5491194809779607] -0.4910055473622208)"},{"type":"list-like","open":"<span class='clj-lazy-seq'>(</span>","close":"<span class='clj-lazy-seq'>)</span>","separator":" ","items":[{"type":"list-like","open":"<span class='clj-vector'>[</span>","close":"<span class='clj-vector'>]</span>","separator":" ","items":[{"type":"html","content":"<span class='clj-double'>3.167417697779358</span>","value":"3.167417697779358"},{"type":"html","content":"<span class='clj-double'>2.5491194809779607</span>","value":"2.5491194809779607"}],"value":"[3.167417697779358 2.5491194809779607]"},{"type":"html","content":"<span class='clj-double'>-0.4888016053764943</span>","value":"-0.4888016053764943"}],"value":"([3.167417697779358 2.5491194809779607] -0.4888016053764943)"},{"type":"list-like","open":"<span class='clj-lazy-seq'>(</span>","close":"<span class='clj-lazy-seq'>)</span>","separator":" ","items":[{"type":"list-like","open":"<span class='clj-vector'>[</span>","close":"<span class='clj-vector'>]</span>","separator":" ","items":[{"type":"html","content":"<span class='clj-double'>3.167417697779358</span>","value":"3.167417697779358"},{"type":"html","content":"<span class='clj-double'>2.5491194809779607</span>","value":"2.5491194809779607"}],"value":"[3.167417697779358 2.5491194809779607]"},{"type":"html","content":"<span class='clj-double'>-0.48972574008760716</span>","value":"-0.48972574008760716"}],"value":"([3.167417697779358 2.5491194809779607] -0.48972574008760716)"},{"type":"list-like","open":"<span class='clj-lazy-seq'>(</span>","close":"<span class='clj-lazy-seq'>)</span>","separator":" ","items":[{"type":"list-like","open":"<span class='clj-vector'>[</span>","close":"<span class='clj-vector'>]</span>","separator":" ","items":[{"type":"html","content":"<span class='clj-double'>3.167417697779358</span>","value":"3.167417697779358"},{"type":"html","content":"<span class='clj-double'>2.5491194809779607</span>","value":"2.5491194809779607"}],"value":"[3.167417697779358 2.5491194809779607]"},{"type":"html","content":"<span class='clj-double'>-0.48931475700783267</span>","value":"-0.48931475700783267"}],"value":"([3.167417697779358 2.5491194809779607] -0.48931475700783267)"},{"type":"list-like","open":"<span class='clj-lazy-seq'>(</span>","close":"<span class='clj-lazy-seq'>)</span>","separator":" ","items":[{"type":"list-like","open":"<span class='clj-vector'>[</span>","close":"<span class='clj-vector'>]</span>","separator":" ","items":[{"type":"html","content":"<span class='clj-double'>3.167417697779358</span>","value":"3.167417697779358"},{"type":"html","content":"<span class='clj-double'>2.5491194809779607</span>","value":"2.5491194809779607"}],"value":"[3.167417697779358 2.5491194809779607]"},{"type":"html","content":"<span class='clj-double'>-0.48823019504186504</span>","value":"-0.48823019504186504"}],"value":"([3.167417697779358 2.5491194809779607] -0.48823019504186504)"},{"type":"list-like","open":"<span class='clj-lazy-seq'>(</span>","close":"<span class='clj-lazy-seq'>)</span>","separator":" ","items":[{"type":"list-like","open":"<span class='clj-vector'>[</span>","close":"<span class='clj-vector'>]</span>","separator":" ","items":[{"type":"html","content":"<span class='clj-double'>3.167417697779358</span>","value":"3.167417697779358"},{"type":"html","content":"<span class='clj-double'>2.5491194809779607</span>","value":"2.5491194809779607"}],"value":"[3.167417697779358 2.5491194809779607]"},{"type":"html","content":"<span class='clj-double'>-0.48798304652356705</span>","value":"-0.48798304652356705"}],"value":"([3.167417697779358 2.5491194809779607] -0.48798304652356705)"},{"type":"list-like","open":"<span class='clj-lazy-seq'>(</span>","close":"<span class='clj-lazy-seq'>)</span>","separator":" ","items":[{"type":"list-like","open":"<span class='clj-vector'>[</span>","close":"<span class='clj-vector'>]</span>","separator":" ","items":[{"type":"html","content":"<span class='clj-double'>3.167417697779358</span>","value":"3.167417697779358"},{"type":"html","content":"<span class='clj-double'>2.5491194809779607</span>","value":"2.5491194809779607"}],"value":"[3.167417697779358 2.5491194809779607]"},{"type":"html","content":"<span class='clj-double'>-0.48843069247877224</span>","value":"-0.48843069247877224"}],"value":"([3.167417697779358 2.5491194809779607] -0.48843069247877224)"},{"type":"list-like","open":"<span class='clj-lazy-seq'>(</span>","close":"<span class='clj-lazy-seq'>)</span>","separator":" ","items":[{"type":"list-like","open":"<span class='clj-vector'>[</span>","close":"<span class='clj-vector'>]</span>","separator":" ","items":[{"type":"html","content":"<span class='clj-double'>3.167417697779358</span>","value":"3.167417697779358"},{"type":"html","content":"<span class='clj-double'>2.5491194809779607</span>","value":"2.5491194809779607"}],"value":"[3.167417697779358 2.5491194809779607]"},{"type":"html","content":"<span class='clj-double'>-0.48758583241138354</span>","value":"-0.48758583241138354"}],"value":"([3.167417697779358 2.5491194809779607] -0.48758583241138354)"},{"type":"list-like","open":"<span class='clj-lazy-seq'>(</span>","close":"<span class='clj-lazy-seq'>)</span>","separator":" ","items":[{"type":"list-like","open":"<span class='clj-vector'>[</span>","close":"<span class='clj-vector'>]</span>","separator":" ","items":[{"type":"html","content":"<span class='clj-double'>3.167417697779358</span>","value":"3.167417697779358"},{"type":"html","content":"<span class='clj-double'>2.5491194809779607</span>","value":"2.5491194809779607"}],"value":"[3.167417697779358 2.5491194809779607]"},{"type":"html","content":"<span class='clj-double'>-0.4877918389155127</span>","value":"-0.4877918389155127"}],"value":"([3.167417697779358 2.5491194809779607] -0.4877918389155127)"},{"type":"list-like","open":"<span class='clj-lazy-seq'>(</span>","close":"<span class='clj-lazy-seq'>)</span>","separator":" ","items":[{"type":"list-like","open":"<span class='clj-vector'>[</span>","close":"<span class='clj-vector'>]</span>","separator":" ","items":[{"type":"html","content":"<span class='clj-double'>3.167417697779358</span>","value":"3.167417697779358"},{"type":"html","content":"<span class='clj-double'>2.5491194809779607</span>","value":"2.5491194809779607"}],"value":"[3.167417697779358 2.5491194809779607]"},{"type":"html","content":"<span class='clj-double'>-0.4873481231097401</span>","value":"-0.4873481231097401"}],"value":"([3.167417697779358 2.5491194809779607] -0.4873481231097401)"},{"type":"list-like","open":"<span class='clj-lazy-seq'>(</span>","close":"<span class='clj-lazy-seq'>)</span>","separator":" ","items":[{"type":"list-like","open":"<span class='clj-vector'>[</span>","close":"<span class='clj-vector'>]</span>","separator":" ","items":[{"type":"html","content":"<span class='clj-double'>3.167417697779358</span>","value":"3.167417697779358"},{"type":"html","content":"<span class='clj-double'>2.5491194809779607</span>","value":"2.5491194809779607"}],"value":"[3.167417697779358 2.5491194809779607]"},{"type":"html","content":"<span class='clj-double'>-0.4877030376490268</span>","value":"-0.4877030376490268"}],"value":"([3.167417697779358 2.5491194809779607] -0.4877030376490268)"},{"type":"list-like","open":"<span class='clj-lazy-seq'>(</span>","close":"<span class='clj-lazy-seq'>)</span>","separator":" ","items":[{"type":"list-like","open":"<span class='clj-vector'>[</span>","close":"<span class='clj-vector'>]</span>","separator":" ","items":[{"type":"html","content":"<span class='clj-double'>3.167417697779358</span>","value":"3.167417697779358"},{"type":"html","content":"<span class='clj-double'>2.5491194809779607</span>","value":"2.5491194809779607"}],"value":"[3.167417697779358 2.5491194809779607]"},{"type":"html","content":"<span class='clj-double'>-0.4875758010981599</span>","value":"-0.4875758010981599"}],"value":"([3.167417697779358 2.5491194809779607] -0.4875758010981599)"},{"type":"list-like","open":"<span class='clj-lazy-seq'>(</span>","close":"<span class='clj-lazy-seq'>)</span>","separator":" ","items":[{"type":"list-like","open":"<span class='clj-vector'>[</span>","close":"<span class='clj-vector'>]</span>","separator":" ","items":[{"type":"html","content":"<span class='clj-double'>3.167417697779358</span>","value":"3.167417697779358"},{"type":"html","content":"<span class='clj-double'>2.5491194809779607</span>","value":"2.5491194809779607"}],"value":"[3.167417697779358 2.5491194809779607]"},{"type":"html","content":"<span class='clj-double'>-0.4879728333950766</span>","value":"-0.4879728333950766"}],"value":"([3.167417697779358 2.5491194809779607] -0.4879728333950766)"},{"type":"list-like","open":"<span class='clj-lazy-seq'>(</span>","close":"<span class='clj-lazy-seq'>)</span>","separator":" ","items":[{"type":"list-like","open":"<span class='clj-vector'>[</span>","close":"<span class='clj-vector'>]</span>","separator":" ","items":[{"type":"html","content":"<span class='clj-double'>3.167417697779358</span>","value":"3.167417697779358"},{"type":"html","content":"<span class='clj-double'>2.5491194809779607</span>","value":"2.5491194809779607"}],"value":"[3.167417697779358 2.5491194809779607]"},{"type":"html","content":"<span class='clj-double'>-0.4878598819723834</span>","value":"-0.4878598819723834"}],"value":"([3.167417697779358 2.5491194809779607] -0.4878598819723834)"},{"type":"list-like","open":"<span class='clj-lazy-seq'>(</span>","close":"<span class='clj-lazy-seq'>)</span>","separator":" ","items":[{"type":"list-like","open":"<span class='clj-vector'>[</span>","close":"<span class='clj-vector'>]</span>","separator":" ","items":[{"type":"html","content":"<span class='clj-double'>3.167417697779358</span>","value":"3.167417697779358"},{"type":"html","content":"<span class='clj-double'>2.5491194809779607</span>","value":"2.5491194809779607"}],"value":"[3.167417697779358 2.5491194809779607]"},{"type":"html","content":"<span class='clj-double'>-0.4880783325102698</span>","value":"-0.4880783325102698"}],"value":"([3.167417697779358 2.5491194809779607] -0.4880783325102698)"},{"type":"list-like","open":"<span class='clj-lazy-seq'>(</span>","close":"<span class='clj-lazy-seq'>)</span>","separator":" ","items":[{"type":"list-like","open":"<span class='clj-vector'>[</span>","close":"<span class='clj-vector'>]</span>","separator":" ","items":[{"type":"html","content":"<span class='clj-double'>3.167417697779358</span>","value":"3.167417697779358"},{"type":"html","content":"<span class='clj-double'>2.5491194809779607</span>","value":"2.5491194809779607"}],"value":"[3.167417697779358 2.5491194809779607]"},{"type":"html","content":"<span class='clj-double'>-0.48730880461445736</span>","value":"-0.48730880461445736"}],"value":"([3.167417697779358 2.5491194809779607] -0.48730880461445736)"},{"type":"list-like","open":"<span class='clj-lazy-seq'>(</span>","close":"<span class='clj-lazy-seq'>)</span>","separator":" ","items":[{"type":"list-like","open":"<span class='clj-vector'>[</span>","close":"<span class='clj-vector'>]</span>","separator":" ","items":[{"type":"html","content":"<span class='clj-double'>3.167417697779358</span>","value":"3.167417697779358"},{"type":"html","content":"<span class='clj-double'>2.5491194809779607</span>","value":"2.5491194809779607"}],"value":"[3.167417697779358 2.5491194809779607]"},{"type":"html","content":"<span class='clj-double'>-0.4877145318810392</span>","value":"-0.4877145318810392"}],"value":"([3.167417697779358 2.5491194809779607] -0.4877145318810392)"},{"type":"list-like","open":"<span class='clj-lazy-seq'>(</span>","close":"<span class='clj-lazy-seq'>)</span>","separator":" ","items":[{"type":"list-like","open":"<span class='clj-vector'>[</span>","close":"<span class='clj-vector'>]</span>","separator":" ","items":[{"type":"html","content":"<span class='clj-double'>3.167417697779358</span>","value":"3.167417697779358"},{"type":"html","content":"<span class='clj-double'>2.5491194809779607</span>","value":"2.5491194809779607"}],"value":"[3.167417697779358 2.5491194809779607]"},{"type":"html","content":"<span class='clj-double'>-0.48750997518567374</span>","value":"-0.48750997518567374"}],"value":"([3.167417697779358 2.5491194809779607] -0.48750997518567374)"},{"type":"list-like","open":"<span class='clj-lazy-seq'>(</span>","close":"<span class='clj-lazy-seq'>)</span>","separator":" ","items":[{"type":"list-like","open":"<span class='clj-vector'>[</span>","close":"<span class='clj-vector'>]</span>","separator":" ","items":[{"type":"html","content":"<span class='clj-double'>3.167417697779358</span>","value":"3.167417697779358"},{"type":"html","content":"<span class='clj-double'>2.5491194809779607</span>","value":"2.5491194809779607"}],"value":"[3.167417697779358 2.5491194809779607]"},{"type":"html","content":"<span class='clj-double'>-0.48755451069382616</span>","value":"-0.48755451069382616"}],"value":"([3.167417697779358 2.5491194809779607] -0.48755451069382616)"},{"type":"list-like","open":"<span class='clj-lazy-seq'>(</span>","close":"<span class='clj-lazy-seq'>)</span>","separator":" ","items":[{"type":"list-like","open":"<span class='clj-vector'>[</span>","close":"<span class='clj-vector'>]</span>","separator":" ","items":[{"type":"html","content":"<span class='clj-double'>3.167417697779358</span>","value":"3.167417697779358"},{"type":"html","content":"<span class='clj-double'>2.5491194809779607</span>","value":"2.5491194809779607"}],"value":"[3.167417697779358 2.5491194809779607]"},{"type":"html","content":"<span class='clj-double'>-0.4883448292957553</span>","value":"-0.4883448292957553"}],"value":"([3.167417697779358 2.5491194809779607] -0.4883448292957553)"},{"type":"list-like","open":"<span class='clj-lazy-seq'>(</span>","close":"<span class='clj-lazy-seq'>)</span>","separator":" ","items":[{"type":"list-like","open":"<span class='clj-vector'>[</span>","close":"<span class='clj-vector'>]</span>","separator":" ","items":[{"type":"html","content":"<span class='clj-double'>3.167417697779358</span>","value":"3.167417697779358"},{"type":"html","content":"<span class='clj-double'>2.5491194809779607</span>","value":"2.5491194809779607"}],"value":"[3.167417697779358 2.5491194809779607]"},{"type":"html","content":"<span class='clj-double'>-0.48801975885038473</span>","value":"-0.48801975885038473"}],"value":"([3.167417697779358 2.5491194809779607] -0.48801975885038473)"},{"type":"list-like","open":"<span class='clj-lazy-seq'>(</span>","close":"<span class='clj-lazy-seq'>)</span>","separator":" ","items":[{"type":"list-like","open":"<span class='clj-vector'>[</span>","close":"<span class='clj-vector'>]</span>","separator":" ","items":[{"type":"html","content":"<span class='clj-double'>3.167417697779358</span>","value":"3.167417697779358"},{"type":"html","content":"<span class='clj-double'>2.5491194809779607</span>","value":"2.5491194809779607"}],"value":"[3.167417697779358 2.5491194809779607]"},{"type":"html","content":"<span class='clj-double'>-0.48762300859047514</span>","value":"-0.48762300859047514"}],"value":"([3.167417697779358 2.5491194809779607] -0.48762300859047514)"},{"type":"list-like","open":"<span class='clj-lazy-seq'>(</span>","close":"<span class='clj-lazy-seq'>)</span>","separator":" ","items":[{"type":"list-like","open":"<span class='clj-vector'>[</span>","close":"<span class='clj-vector'>]</span>","separator":" ","items":[{"type":"html","content":"<span class='clj-double'>3.167417697779358</span>","value":"3.167417697779358"},{"type":"html","content":"<span class='clj-double'>2.5491194809779607</span>","value":"2.5491194809779607"}],"value":"[3.167417697779358 2.5491194809779607]"},{"type":"html","content":"<span class='clj-double'>-0.4877262571617109</span>","value":"-0.4877262571617109"}],"value":"([3.167417697779358 2.5491194809779607] -0.4877262571617109)"},{"type":"list-like","open":"<span class='clj-lazy-seq'>(</span>","close":"<span class='clj-lazy-seq'>)</span>","separator":" ","items":[{"type":"list-like","open":"<span class='clj-vector'>[</span>","close":"<span class='clj-vector'>]</span>","separator":" ","items":[{"type":"html","content":"<span class='clj-double'>3.167417697779358</span>","value":"3.167417697779358"},{"type":"html","content":"<span class='clj-double'>2.5491194809779607</span>","value":"2.5491194809779607"}],"value":"[3.167417697779358 2.5491194809779607]"},{"type":"html","content":"<span class='clj-double'>-0.4872381480684851</span>","value":"-0.4872381480684851"}],"value":"([3.167417697779358 2.5491194809779607] -0.4872381480684851)"},{"type":"list-like","open":"<span class='clj-lazy-seq'>(</span>","close":"<span class='clj-lazy-seq'>)</span>","separator":" ","items":[{"type":"list-like","open":"<span class='clj-vector'>[</span>","close":"<span class='clj-vector'>]</span>","separator":" ","items":[{"type":"html","content":"<span class='clj-double'>3.167417697779358</span>","value":"3.167417697779358"},{"type":"html","content":"<span class='clj-double'>2.5491194809779607</span>","value":"2.5491194809779607"}],"value":"[3.167417697779358 2.5491194809779607]"},{"type":"html","content":"<span class='clj-double'>-0.4876663681353648</span>","value":"-0.4876663681353648"}],"value":"([3.167417697779358 2.5491194809779607] -0.4876663681353648)"},{"type":"list-like","open":"<span class='clj-lazy-seq'>(</span>","close":"<span class='clj-lazy-seq'>)</span>","separator":" ","items":[{"type":"list-like","open":"<span class='clj-vector'>[</span>","close":"<span class='clj-vector'>]</span>","separator":" ","items":[{"type":"html","content":"<span class='clj-double'>3.167417697779358</span>","value":"3.167417697779358"},{"type":"html","content":"<span class='clj-double'>2.5491194809779607</span>","value":"2.5491194809779607"}],"value":"[3.167417697779358 2.5491194809779607]"},{"type":"html","content":"<span class='clj-double'>-0.4875449341617184</span>","value":"-0.4875449341617184"}],"value":"([3.167417697779358 2.5491194809779607] -0.4875449341617184)"},{"type":"list-like","open":"<span class='clj-lazy-seq'>(</span>","close":"<span class='clj-lazy-seq'>)</span>","separator":" ","items":[{"type":"list-like","open":"<span class='clj-vector'>[</span>","close":"<span class='clj-vector'>]</span>","separator":" ","items":[{"type":"html","content":"<span class='clj-double'>3.167417697779358</span>","value":"3.167417697779358"},{"type":"html","content":"<span class='clj-double'>2.5491194809779607</span>","value":"2.5491194809779607"}],"value":"[3.167417697779358 2.5491194809779607]"},{"type":"html","content":"<span class='clj-double'>-0.48765637380665794</span>","value":"-0.48765637380665794"}],"value":"([3.167417697779358 2.5491194809779607] -0.48765637380665794)"},{"type":"list-like","open":"<span class='clj-lazy-seq'>(</span>","close":"<span class='clj-lazy-seq'>)</span>","separator":" ","items":[{"type":"list-like","open":"<span class='clj-vector'>[</span>","close":"<span class='clj-vector'>]</span>","separator":" ","items":[{"type":"html","content":"<span class='clj-double'>3.167417697779358</span>","value":"3.167417697779358"},{"type":"html","content":"<span class='clj-double'>2.5491194809779607</span>","value":"2.5491194809779607"}],"value":"[3.167417697779358 2.5491194809779607]"},{"type":"html","content":"<span class='clj-double'>-0.4875924021362721</span>","value":"-0.4875924021362721"}],"value":"([3.167417697779358 2.5491194809779607] -0.4875924021362721)"},{"type":"list-like","open":"<span class='clj-lazy-seq'>(</span>","close":"<span class='clj-lazy-seq'>)</span>","separator":" ","items":[{"type":"list-like","open":"<span class='clj-vector'>[</span>","close":"<span class='clj-vector'>]</span>","separator":" ","items":[{"type":"html","content":"<span class='clj-double'>3.167417697779358</span>","value":"3.167417697779358"},{"type":"html","content":"<span class='clj-double'>2.5491194809779607</span>","value":"2.5491194809779607"}],"value":"[3.167417697779358 2.5491194809779607]"},{"type":"html","content":"<span class='clj-double'>-0.48820610366863093</span>","value":"-0.48820610366863093"}],"value":"([3.167417697779358 2.5491194809779607] -0.48820610366863093)"},{"type":"list-like","open":"<span class='clj-lazy-seq'>(</span>","close":"<span class='clj-lazy-seq'>)</span>","separator":" ","items":[{"type":"list-like","open":"<span class='clj-vector'>[</span>","close":"<span class='clj-vector'>]</span>","separator":" ","items":[{"type":"html","content":"<span class='clj-double'>3.167417697779358</span>","value":"3.167417697779358"},{"type":"html","content":"<span class='clj-double'>2.5491194809779607</span>","value":"2.5491194809779607"}],"value":"[3.167417697779358 2.5491194809779607]"},{"type":"html","content":"<span class='clj-double'>-0.4881319729649647</span>","value":"-0.4881319729649647"}],"value":"([3.167417697779358 2.5491194809779607] -0.4881319729649647)"},{"type":"list-like","open":"<span class='clj-lazy-seq'>(</span>","close":"<span class='clj-lazy-seq'>)</span>","separator":" ","items":[{"type":"list-like","open":"<span class='clj-vector'>[</span>","close":"<span class='clj-vector'>]</span>","separator":" ","items":[{"type":"html","content":"<span class='clj-double'>3.167417697779358</span>","value":"3.167417697779358"},{"type":"html","content":"<span class='clj-double'>2.5491194809779607</span>","value":"2.5491194809779607"}],"value":"[3.167417697779358 2.5491194809779607]"},{"type":"html","content":"<span class='clj-double'>-0.48773580889238133</span>","value":"-0.48773580889238133"}],"value":"([3.167417697779358 2.5491194809779607] -0.48773580889238133)"},{"type":"list-like","open":"<span class='clj-lazy-seq'>(</span>","close":"<span class='clj-lazy-seq'>)</span>","separator":" ","items":[{"type":"list-like","open":"<span class='clj-vector'>[</span>","close":"<span class='clj-vector'>]</span>","separator":" ","items":[{"type":"html","content":"<span class='clj-double'>3.167417697779358</span>","value":"3.167417697779358"},{"type":"html","content":"<span class='clj-double'>2.5491194809779607</span>","value":"2.5491194809779607"}],"value":"[3.167417697779358 2.5491194809779607]"},{"type":"html","content":"<span class='clj-double'>-0.4866447230646145</span>","value":"-0.4866447230646145"}],"value":"([3.167417697779358 2.5491194809779607] -0.4866447230646145)"},{"type":"list-like","open":"<span class='clj-lazy-seq'>(</span>","close":"<span class='clj-lazy-seq'>)</span>","separator":" ","items":[{"type":"list-like","open":"<span class='clj-vector'>[</span>","close":"<span class='clj-vector'>]</span>","separator":" ","items":[{"type":"html","content":"<span class='clj-double'>3.167417697779358</span>","value":"3.167417697779358"},{"type":"html","content":"<span class='clj-double'>2.5491194809779607</span>","value":"2.5491194809779607"}],"value":"[3.167417697779358 2.5491194809779607]"},{"type":"html","content":"<span class='clj-double'>-0.4875909502314357</span>","value":"-0.4875909502314357"}],"value":"([3.167417697779358 2.5491194809779607] -0.4875909502314357)"},{"type":"list-like","open":"<span class='clj-lazy-seq'>(</span>","close":"<span class='clj-lazy-seq'>)</span>","separator":" ","items":[{"type":"list-like","open":"<span class='clj-vector'>[</span>","close":"<span class='clj-vector'>]</span>","separator":" ","items":[{"type":"html","content":"<span class='clj-double'>3.167417697779358</span>","value":"3.167417697779358"},{"type":"html","content":"<span class='clj-double'>2.5491194809779607</span>","value":"2.5491194809779607"}],"value":"[3.167417697779358 2.5491194809779607]"},{"type":"html","content":"<span class='clj-double'>-0.48770478720152255</span>","value":"-0.48770478720152255"}],"value":"([3.167417697779358 2.5491194809779607] -0.48770478720152255)"},{"type":"list-like","open":"<span class='clj-lazy-seq'>(</span>","close":"<span class='clj-lazy-seq'>)</span>","separator":" ","items":[{"type":"list-like","open":"<span class='clj-vector'>[</span>","close":"<span class='clj-vector'>]</span>","separator":" ","items":[{"type":"html","content":"<span class='clj-double'>3.167417697779358</span>","value":"3.167417697779358"},{"type":"html","content":"<span class='clj-double'>2.5491194809779607</span>","value":"2.5491194809779607"}],"value":"[3.167417697779358 2.5491194809779607]"},{"type":"html","content":"<span class='clj-double'>-0.48758580552359376</span>","value":"-0.48758580552359376"}],"value":"([3.167417697779358 2.5491194809779607] -0.48758580552359376)"},{"type":"list-like","open":"<span class='clj-lazy-seq'>(</span>","close":"<span class='clj-lazy-seq'>)</span>","separator":" ","items":[{"type":"list-like","open":"<span class='clj-vector'>[</span>","close":"<span class='clj-vector'>]</span>","separator":" ","items":[{"type":"html","content":"<span class='clj-double'>3.167417697779358</span>","value":"3.167417697779358"},{"type":"html","content":"<span class='clj-double'>2.5491194809779607</span>","value":"2.5491194809779607"}],"value":"[3.167417697779358 2.5491194809779607]"},{"type":"html","content":"<span class='clj-double'>-0.48757905649051736</span>","value":"-0.48757905649051736"}],"value":"([3.167417697779358 2.5491194809779607] -0.48757905649051736)"},{"type":"list-like","open":"<span class='clj-lazy-seq'>(</span>","close":"<span class='clj-lazy-seq'>)</span>","separator":" ","items":[{"type":"list-like","open":"<span class='clj-vector'>[</span>","close":"<span class='clj-vector'>]</span>","separator":" ","items":[{"type":"html","content":"<span class='clj-double'>3.167417697779358</span>","value":"3.167417697779358"},{"type":"html","content":"<span class='clj-double'>2.5491194809779607</span>","value":"2.5491194809779607"}],"value":"[3.167417697779358 2.5491194809779607]"},{"type":"html","content":"<span class='clj-double'>-0.4876504663543244</span>","value":"-0.4876504663543244"}],"value":"([3.167417697779358 2.5491194809779607] -0.4876504663543244)"},{"type":"list-like","open":"<span class='clj-lazy-seq'>(</span>","close":"<span class='clj-lazy-seq'>)</span>","separator":" ","items":[{"type":"list-like","open":"<span class='clj-vector'>[</span>","close":"<span class='clj-vector'>]</span>","separator":" ","items":[{"type":"html","content":"<span class='clj-double'>3.167417697779358</span>","value":"3.167417697779358"},{"type":"html","content":"<span class='clj-double'>2.5491194809779607</span>","value":"2.5491194809779607"}],"value":"[3.167417697779358 2.5491194809779607]"},{"type":"html","content":"<span class='clj-double'>-0.4880216615561892</span>","value":"-0.4880216615561892"}],"value":"([3.167417697779358 2.5491194809779607] -0.4880216615561892)"},{"type":"list-like","open":"<span class='clj-lazy-seq'>(</span>","close":"<span class='clj-lazy-seq'>)</span>","separator":" ","items":[{"type":"list-like","open":"<span class='clj-vector'>[</span>","close":"<span class='clj-vector'>]</span>","separator":" ","items":[{"type":"html","content":"<span class='clj-double'>3.167417697779358</span>","value":"3.167417697779358"},{"type":"html","content":"<span class='clj-double'>2.5491194809779607</span>","value":"2.5491194809779607"}],"value":"[3.167417697779358 2.5491194809779607]"},{"type":"html","content":"<span class='clj-double'>-0.4875324451999461</span>","value":"-0.4875324451999461"}],"value":"([3.167417697779358 2.5491194809779607] -0.4875324451999461)"},{"type":"list-like","open":"<span class='clj-lazy-seq'>(</span>","close":"<span class='clj-lazy-seq'>)</span>","separator":" ","items":[{"type":"list-like","open":"<span class='clj-vector'>[</span>","close":"<span class='clj-vector'>]</span>","separator":" ","items":[{"type":"html","content":"<span class='clj-double'>9.248896048638265</span>","value":"9.248896048638265"},{"type":"html","content":"<span class='clj-double'>2.6011526854400078</span>","value":"2.6011526854400078"}],"value":"[9.248896048638265 2.6011526854400078]"},{"type":"html","content":"<span class='clj-double'>-0.8214581467618132</span>","value":"-0.8214581467618132"}],"value":"([9.248896048638265 2.6011526854400078] -0.8214581467618132)"},{"type":"list-like","open":"<span class='clj-lazy-seq'>(</span>","close":"<span class='clj-lazy-seq'>)</span>","separator":" ","items":[{"type":"list-like","open":"<span class='clj-vector'>[</span>","close":"<span class='clj-vector'>]</span>","separator":" ","items":[{"type":"html","content":"<span class='clj-double'>3.167417697779358</span>","value":"3.167417697779358"},{"type":"html","content":"<span class='clj-double'>2.5491194809779607</span>","value":"2.5491194809779607"}],"value":"[3.167417697779358 2.5491194809779607]"},{"type":"html","content":"<span class='clj-double'>-0.48774988919353746</span>","value":"-0.48774988919353746"}],"value":"([3.167417697779358 2.5491194809779607] -0.48774988919353746)"},{"type":"list-like","open":"<span class='clj-lazy-seq'>(</span>","close":"<span class='clj-lazy-seq'>)</span>","separator":" ","items":[{"type":"list-like","open":"<span class='clj-vector'>[</span>","close":"<span class='clj-vector'>]</span>","separator":" ","items":[{"type":"html","content":"<span class='clj-double'>3.167417697779358</span>","value":"3.167417697779358"},{"type":"html","content":"<span class='clj-double'>2.5491194809779607</span>","value":"2.5491194809779607"}],"value":"[3.167417697779358 2.5491194809779607]"},{"type":"html","content":"<span class='clj-double'>-0.4876039436338715</span>","value":"-0.4876039436338715"}],"value":"([3.167417697779358 2.5491194809779607] -0.4876039436338715)"},{"type":"list-like","open":"<span class='clj-lazy-seq'>(</span>","close":"<span class='clj-lazy-seq'>)</span>","separator":" ","items":[{"type":"list-like","open":"<span class='clj-vector'>[</span>","close":"<span class='clj-vector'>]</span>","separator":" ","items":[{"type":"html","content":"<span class='clj-double'>3.167417697779358</span>","value":"3.167417697779358"},{"type":"html","content":"<span class='clj-double'>2.5491194809779607</span>","value":"2.5491194809779607"}],"value":"[3.167417697779358 2.5491194809779607]"},{"type":"html","content":"<span class='clj-double'>-0.4877336302196227</span>","value":"-0.4877336302196227"}],"value":"([3.167417697779358 2.5491194809779607] -0.4877336302196227)"},{"type":"list-like","open":"<span class='clj-lazy-seq'>(</span>","close":"<span class='clj-lazy-seq'>)</span>","separator":" ","items":[{"type":"list-like","open":"<span class='clj-vector'>[</span>","close":"<span class='clj-vector'>]</span>","separator":" ","items":[{"type":"html","content":"<span class='clj-double'>3.167417697779358</span>","value":"3.167417697779358"},{"type":"html","content":"<span class='clj-double'>2.5491194809779607</span>","value":"2.5491194809779607"}],"value":"[3.167417697779358 2.5491194809779607]"},{"type":"html","content":"<span class='clj-double'>-0.48773490510257034</span>","value":"-0.48773490510257034"}],"value":"([3.167417697779358 2.5491194809779607] -0.48773490510257034)"},{"type":"list-like","open":"<span class='clj-lazy-seq'>(</span>","close":"<span class='clj-lazy-seq'>)</span>","separator":" ","items":[{"type":"list-like","open":"<span class='clj-vector'>[</span>","close":"<span class='clj-vector'>]</span>","separator":" ","items":[{"type":"html","content":"<span class='clj-double'>3.167417697779358</span>","value":"3.167417697779358"},{"type":"html","content":"<span class='clj-double'>2.5491194809779607</span>","value":"2.5491194809779607"}],"value":"[3.167417697779358 2.5491194809779607]"},{"type":"html","content":"<span class='clj-double'>-0.4876884570085167</span>","value":"-0.4876884570085167"}],"value":"([3.167417697779358 2.5491194809779607] -0.4876884570085167)"}],"value":"[([2.3845486350346663 0.6159033330347463] -8.419822392806765) ([3.8264082295532678 1.6600246609764178] -2.584789801536374) ([3.8264082295532678 1.6600246609764178] -2.5858003260117925) ([3.8264082295532678 1.6600246609764178] -2.584761305260429) ([3.167417697779358 2.5491194809779607] -0.491256816081318) ([3.167417697779358 2.5491194809779607] -0.4910055473622208) ([3.167417697779358 2.5491194809779607] -0.4888016053764943) ([3.167417697779358 2.5491194809779607] -0.48972574008760716) ([3.167417697779358 2.5491194809779607] -0.48931475700783267) ([3.167417697779358 2.5491194809779607] -0.48823019504186504) ([3.167417697779358 2.5491194809779607] -0.48798304652356705) ([3.167417697779358 2.5491194809779607] -0.48843069247877224) ([3.167417697779358 2.5491194809779607] -0.48758583241138354) ([3.167417697779358 2.5491194809779607] -0.4877918389155127) ([3.167417697779358 2.5491194809779607] -0.4873481231097401) ([3.167417697779358 2.5491194809779607] -0.4877030376490268) ([3.167417697779358 2.5491194809779607] -0.4875758010981599) ([3.167417697779358 2.5491194809779607] -0.4879728333950766) ([3.167417697779358 2.5491194809779607] -0.4878598819723834) ([3.167417697779358 2.5491194809779607] -0.4880783325102698) ([3.167417697779358 2.5491194809779607] -0.48730880461445736) ([3.167417697779358 2.5491194809779607] -0.4877145318810392) ([3.167417697779358 2.5491194809779607] -0.48750997518567374) ([3.167417697779358 2.5491194809779607] -0.48755451069382616) ([3.167417697779358 2.5491194809779607] -0.4883448292957553) ([3.167417697779358 2.5491194809779607] -0.48801975885038473) ([3.167417697779358 2.5491194809779607] -0.48762300859047514) ([3.167417697779358 2.5491194809779607] -0.4877262571617109) ([3.167417697779358 2.5491194809779607] -0.4872381480684851) ([3.167417697779358 2.5491194809779607] -0.4876663681353648) ([3.167417697779358 2.5491194809779607] -0.4875449341617184) ([3.167417697779358 2.5491194809779607] -0.48765637380665794) ([3.167417697779358 2.5491194809779607] -0.4875924021362721) ([3.167417697779358 2.5491194809779607] -0.48820610366863093) ([3.167417697779358 2.5491194809779607] -0.4881319729649647) ([3.167417697779358 2.5491194809779607] -0.48773580889238133) ([3.167417697779358 2.5491194809779607] -0.4866447230646145) ([3.167417697779358 2.5491194809779607] -0.4875909502314357) ([3.167417697779358 2.5491194809779607] -0.48770478720152255) ([3.167417697779358 2.5491194809779607] -0.48758580552359376) ([3.167417697779358 2.5491194809779607] -0.48757905649051736) ([3.167417697779358 2.5491194809779607] -0.4876504663543244) ([3.167417697779358 2.5491194809779607] -0.4880216615561892) ([3.167417697779358 2.5491194809779607] -0.4875324451999461) ([9.248896048638265 2.6011526854400078] -0.8214581467618132) ([3.167417697779358 2.5491194809779607] -0.48774988919353746) ([3.167417697779358 2.5491194809779607] -0.4876039436338715) ([3.167417697779358 2.5491194809779607] -0.4877336302196227) ([3.167417697779358 2.5491194809779607] -0.48773490510257034) ([3.167417697779358 2.5491194809779607] -0.4876884570085167)]"}
;; <=

;; **
;;; ## Hartmann 6D
;; **

;; **
;;; @@\begin{align}
;;; f(x) &= -\sum\_{i=1}^{4} \alpha\_i \exp \left(-\sum\_{j=1}^{6} A\_{i,j}(x\_j-P\_{i,j})^2\right), \quad \rm{where} \\\\
;;; \alpha &= (1,1.2,3,3.2)^T \\\\
;;; A &= \left(\begin{matrix}
;;; 10 & 3 & 17 & 3.5 & 1.6 & 8 \\\\
;;; 0.05 & 10 & 17 & 0.1 & 8 & 14 \\\\
;;; 3 & 3.5 & 1.7 & 10 & 17 & 8 \\\\
;;; 17 & 8 & 0.05 & 10 & 0.1 & 14
;;; \end{matrix}\right) \\\\
;;; P &= 10^{-4} \left(
;;; \begin{matrix}
;;; 1312 & 1696 & 5569 & 124 & 8283 & 5886\\\\
;;; 2329 & 4135 & 8307 & 3736 & 1004 & 9991 \\\\
;;; 2358 & 1451 & 3522 & 2883 & 3047 & 6650 \\\\
;;; 4047 & 8828 & 8732 & 5743 & 1091 & 381
;;; \end{matrix}
;;; \right)
;;; \end{align}@@
;;; 
;;; Bounds @@0 \le x\_i \le 1, \; \forall i \in \\{1,\dots,6\\}@@
;;; 
;;; The function has 6 local minima and one global minima at
;;; @@\begin{align}
;;; x^\* &= (0.20169,0.150011,0.476874,0.275332,0.311652,0.6573),
;;; \end{align}@@
;;; with @@f(x^\*) = -3.32237@@.  
;; **

;; @@
(def A
  [[10 3 17 3.5 1.7 8]
   [0.05 10 17 0.1 8 14]
   [3 3.5 1.7 10 17 8]
   [17 8 0.05 10 0.1 14]])

(def P
  [[0.1312 0.1696 0.5569 0.0124 0.8283 0.5886]
   [0.2329 0.4135 0.8307 0.3736 0.1004 0.9991]
   [0.2348 0.1451 0.3522 0.2883 0.3047 0.6650]
   [0.4047 0.8828 0.8732 0.5743 0.1091 0.0381]])

(def alpha
  [1 1.2 3 3.2])

(defn hartman-6d [x1 x2 x3 x4 x5 x6]
  (let [x [x1 x2 x3 x4 x5 x6]
        dxP (mat/pow
             (mat/sub P x)
             2)
        terms (mat/transpose
               (mat/mul A dxP))
        terms-reduced (reduce mat/add terms)
        exp-terms (mat/exp
                   (mat/sub 0 terms-reduced))
        f (- 0
             (reduce + (mat/mul alpha exp-terms)))]
    (- f)))

(with-primitive-procedures [factor hartman-6d]
 (defopt h6 [] [x1 x2 x3 x4 x5 x6]
   (let [x1 (sample (uniform-continuous 0 1))
         x2 (sample (uniform-continuous 0 1))
         x3 (sample (uniform-continuous 0 1))
         x4 (sample (uniform-continuous 0 1))
         x5 (sample (uniform-continuous 0 1))
         x6 (sample (uniform-continuous 0 1))
         f (hartman-6d x1 x2 x3 x4 x5 x6)
         prior-correction 0]
     (observe (factor)
              (+ (hartman-6d x1 x2 x3 x4 x5 x6)
                 prior-correction)))))
;; @@

;; @@

;; @@
